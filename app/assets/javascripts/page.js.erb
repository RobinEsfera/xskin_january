var app = angular.module("myApp", ['ngSanitize']);

// app.controller('AppController', ['$sce',
//     function($sce) {
//       var self = this;
      
//       self.explicitlyTrustedHtml = $sce.trustAsHtml(
//           "<div class=\"placeholder grabbable image-transformable ui-droppable\" data-tpid=\"0\" style=\"top:0px; left:0px; width:189px; height:210px;\" aria-disabled=\"false\">test</div><div class=\"placeholder grabbable image-transformable ui-droppable\" data-tpid=\"1\" style=\"top:0px; left:189px; width:91px; height:105px;\" aria-disabled=\"false\">test1</div>");
//     }]);

// app.controller('AppController', ['$http','$sce',
//     function($http,$sce) {
//       var self = this;
      
//     $http.get("http://www.w3schools.com/angular/customers.php")
//     .then(function(response) {
//        self.explicitlyTrustedHtml = $sce.trustAsHtml(

//         );
//         $scope.names = response.data.records;
//     });
// }]);

app.controller('AppController', function($scope, $http) {
   // $scope.atribut="val 1";

    var myLyt = "rand";
    $scope.readAttr = function(item) {
        // var myEl = angular.element( document.querySelector( '.xskin-case-layout li a' ) );
        // alert(item);
        myLyt = item;
  $http.get("http://192.168.1.34:3000/layout.json")
    .then(function(response) {$scope.grids = response.data[myLyt];});

    };
  $http.get("http://192.168.1.34:3000/layout.json")
    .then(function(response) {$scope.grids = response.data[myLyt];});
});
  
// function myCtrl($scope) {
 
// }

$(function () {
    if ($("body").hasClass("page_make"))
    {
    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');
    var img = new Image();
    img.crossOrigin = '';
    img.src = 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/123941/koala.jpg';
    img.onload = function () {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0, img.width, img.height);
    };
    var $reset = $('#resetbtn');
    var $brightness = $('#brightnessbtn');
    var $noise = $('#noisebtn');
    var $sepia = $('#sepiabtn');
    var $contrast = $('#contrastbtn');
    var $color = $('#colorbtn');
    var $vintage = $('#vintagebtn');
    var $lomo = $('#lomobtn');
    var $emboss = $('#embossbtn');
    var $tiltshift = $('#tiltshiftbtn');
    var $radialblur = $('#radialblurbtn');
    var $edgeenhance = $('#edgeenhancebtn');
    var $posterize = $('#posterizebtn');
    var $clarity = $('#claritybtn');
    var $orangepeel = $('#orangepeelbtn');
    var $sincity = $('#sincitybtn');
    var $sunrise = $('#sunrisebtn');
    var $crossprocess = $('#crossprocessbtn');
    var $hazydays = $('#hazydaysbtn');
    var $love = $('#lovebtn');
    var $grungy = $('#grungybtn');
    var $jarques = $('#jarquesbtn');
    var $pinhole = $('#pinholebtn');
    var $oldboot = $('#oldbootbtn');
    var $glowingsun = $('#glowingsunbtn');
    var $hdr = $('#hdrbtn');
    var $oldpaper = $('#oldpaperbtn');
    var $pleasant = $('#pleasantbtn');
    var $save = $('#savebtn');
    $('input[type=range]').change(applyFilters);
    function applyFilters() {
        var hue = parseInt($('#hue').val());
        var cntrst = parseInt($('#contrast').val());
        var vibr = parseInt($('#vibrance').val());
        var sep = parseInt($('#sepia').val());
        Caman('#canvas', img, function () {
            this.revert(false);
            this.hue(hue).contrast(cntrst).vibrance(vibr).sepia(sep).render();
        });
    }
    Caman.Filter.register('oldpaper', function () {
        this.pinhole();
        this.noise(10);
        this.orangePeel();
        this.render();
    });
    Caman.Filter.register('pleasant', function () {
        this.colorize(60, 105, 218, 10);
        this.contrast(10);
        this.sunrise();
        this.hazyDays();
        this.render();
    });
    $reset.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        $('input[type=range]').val(0);
        Caman('#canvas', img, function () {
            this.revert(false);
            this.render();
        });
    });
    $brightness.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.brightness(30).render();
        });
    });
    $noise.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.noise(10).render();
        });
    });
    $contrast.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.contrast(10).render();
        });
    });
    $sepia.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.sepia(20).render();
        });
    });
    $color.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.colorize(60, 105, 218, 10).render();
        });
    });
    $vintage.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.vintage().render();
        });
    });
    $lomo.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.lomo().render();
        });
    });
    $emboss.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.emboss().render();
        });
    });
    $tiltshift.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.tiltShift({
                angle: 90,
                focusWidth: 600
            }).render();
        });
    });
    $radialblur.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.radialBlur().render();
        });
    });
    $edgeenhance.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.edgeEnhance().render();
        });
    });
    $posterize.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.posterize(8, 8).render();
        });
    });
    $clarity.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.clarity().render();
        });
    });
    $orangepeel.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.orangePeel().render();
        });
    });
    $sincity.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.sinCity().render();
        });
    });
    $sunrise.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.sunrise().render();
        });
    });
    $crossprocess.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.crossProcess().render();
        });
    });
    $love.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.love().render();
        });
    });
    $grungy.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.grungy().render();
        });
    });
    $jarques.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.jarques().render();
        });
    });
    $pinhole.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.pinhole().render();
        });
    });
    $oldboot.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.oldBoot().render();
        });
    });
    $glowingsun.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.glowingSun().render();
        });
    });
    $hazydays.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.hazyDays().render();
        });
    });
    $hdr.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.contrast(10);
            this.contrast(10);
            this.jarques();
            this.render();
        });
    });
    $oldpaper.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.oldpaper();
            this.render();
        });
    });
    $pleasant.on('click', function (e) {
    $("ul.xskin-your-own-case li a i").remove();
    $(this).children("a").prepend("<i class='fa fa-check'></i>");
        Caman('#canvas', img, function () {
            this.pleasant();
            this.render();
        });
    });
    $save.on('click', function (e) {
        Caman('#canvas', img, function () {
            this.render(function () {
                this.save('png');
            });
        });
    });
}
});